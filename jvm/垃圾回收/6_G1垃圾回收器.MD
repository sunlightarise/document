### G1 Garbage First Collector （G1）

* 吞吐量
  * 吞吐量关注的是，在一个指定的时间内，最大化一个应用工作量。
  * 如下方式来衡量一个系统的吞吐量的好坏；
    * 在一个小时内一个事务（或者任务、请求）完成的次数（TPS）
    * 数据库一个小时可以完成多少次查询
  * 关于关注吞吐量的系统，卡顿是可以接受的，因为这个系统关注长时间的大量任务的执行能力，单词快速的响应并不值得考虑。

* 响应能力
  * 响应能力是指一个程序或者系统对请求是否能够及时响应，比如：
    * 一个桌面UI能够多快地响应一个事件
    * 一个网站能够多快返回一个页面请求
    * 数据库能够多快返回查询的数据
  * 对于这类对响应能力灵敏的场景，长时间的的停顿是无法接受的。
  
### G1 Garbage Collector
* G1 收集器是一个面向服务端的垃圾收集器，适用于多核处理器、大内存容量的服务端系统。
* 它满足短时间GC停顿的同时达到一个较高的吞吐量。
* JDK7 以上版本适用。

### G1 收集器的设计目标
* 与应用线程同时工作，几乎不需要 stop the world（与CMS类似）
* 整理剩余空间，不产生内存碎片（CMS只能在Full GC时， 用Stop the World 整理内存碎片）
* GC停顿更加可控
* 不牺牲系统的吞吐量
* GC不要求额外的内存空间（CMS 需要预留空间存储**浮动垃圾**） 
  * 浮动垃圾，并发清理阶段用户线程还在运行，这段时间可能产生新的垃圾，新的垃圾在此次GC无法清除，只能等待下一次GC，这些垃圾称为"浮动垃圾"
* **G1的设计规划是替换掉CMS**
  * G1在某些方面弥补了CMS的一些不足， 比如，CMS使用的是**mark-sweep算法**，自然会产生内存碎片；然而G1基于**copying算法**，高效的整理剩余内存，
  而不是需要管理内存碎片
  * 另外，G1提供了更多的手段，已达到堆GC停顿时间的可控。
  
### Hotspot 虚拟机主要构成
![avatar](../../images/jvm/gc/6.PNG)

### 传统垃圾收集器堆内存结构
![avatar](../../images/jvm/gc/Hotspot_Heap_Structure.PNG)

### G1收集器堆结构
![avatar](../../images/jvm/gc/G1_Heap_Alloction.PNG)

* Heap 被划分为一个个相等的不连续的内存区域（regions）,每个region 都由一个分代的角色：eden、survivor、old
* 堆每一个角色的数量没有强制的现拟定，也就是说对每一种分代内存的打下，可以动态的变化。
* G1 最大的特点就是高效的执行回收，优先去执行哪些大量独享可回收的区域（region）

